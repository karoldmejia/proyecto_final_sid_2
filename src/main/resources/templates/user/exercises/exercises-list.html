<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/baseUser}">
<div th:fragment="content">

    <link rel="icon" th:href="@{/images/logo/icesifit_logo_negro.svg}" media="(prefers-color-scheme: light)">
    <link rel="icon" th:href="@{/images/logo/icesifit_logo_blanco.svg}" media="(prefers-color-scheme: dark)">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/main.css}">
    <link rel="stylesheet" th:href="@{/css/components/header_user_mngmt.css}">
    <link rel="stylesheet" th:href="@{/css/users/personas.css}">
    <link rel="stylesheet" th:href="@{/styles.css}">

    <div class="header-actions">
        <h1 class="text-2xl font-bold">
            Lista de Ejercicios
        </h1>

        <button type="button" onclick="openModal(&#39;/compu2-class/user/exercises/new&#39;)" class="add-user-btn">
            <span class="material-icons-round">add</span>
            Añadir Ejercicio
        </button>
    </div>
    <table>
        <thead>
        <tr>
            <th>Nombre</th>
            <th>Tipo</th>
            <th>Dificultad</th>
            <th>Duración</th>
            <th style="text-align: right;">Acciones</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="exercise : ${exercises}">
            <td th:text="${exercise.name}">Press de Banca</td>
            <td th:text="${exercise.type}">Fuerza</td>
            <td th:text="${exercise.difficulty}">Intermedio</td>
            <td th:text="|${exercise.duration} min|">10 min</td>

            <td class="action-cell">
                <button class="action-btn" onclick="toggleMenu(this)">
                    <span class="material-icons-round">more_vert</span>
                </button>

                <div class="dropdown-menu">

                    <button type="button"
                            onclick="openModal(&#39;/compu2-class/user/exercises/edit/69127dae6675127bf50cfe1a&#39;)"
                            class="dropdown-item">
                        <span class="material-icons-round">edit</span>
                        Editar
                    </button>
                    <form action="/compu2-class/user/exercises/delete/69127dae6675127bf50cfe1a" method="post" style="margin: 0;"><input type="hidden" name="_csrf" value="D_fMvJboYnjfrmnwQWknWG9H4Tug4ARxuDMNn46uwKjEb2aOPs-ui6HZUBzyy1mTJUQTbVh-zAKQ0DZc3Atup7_M8J3yWwTv"/>
                        <button type="submit" class="dropdown-item" onclick="return confirm('¿Estás seguro?')">
                            <span class="material-icons-round">delete</span>
                            Eliminar
                        </button>
                    </form>
                </div>
            </td>
        </tr>
        <tr>
            <td>Jumping Jacks</td>
            <td>Cardio</td>
            <td>Easy</td>
            <td>8.0 min</td>

            <td class="action-cell">
                <button class="action-btn" onclick="toggleMenu(this)">
                    <span class="material-icons-round">more_vert</span>
                </button>

                <div class="dropdown-menu">

                    <button type="button"
                            onclick="openModal(&#39;/compu2-class/user/exercises/edit/69127dae6675127bf50cfe1b&#39;)"
                            class="dropdown-item">
                        <span class="material-icons-round">edit</span>
                        Editar
                    </button>
                    <form action="/compu2-class/user/exercises/delete/69127dae6675127bf50cfe1b" method="post" style="margin: 0;"><input type="hidden" name="_csrf" value="D_fMvJboYnjfrmnwQWknWG9H4Tug4ARxuDMNn46uwKjEb2aOPs-ui6HZUBzyy1mTJUQTbVh-zAKQ0DZc3Atup7_M8J3yWwTv"/>
                        <button type="submit" class="dropdown-item" onclick="return confirm('¿Estás seguro?')">
                            <span class="material-icons-round">delete</span>
                            Eliminar
                        </button>
                    </form>
                </div>
            </td>
        </tr>
        <tr>
            <td>Squats</td>
            <td>Strength</td>
            <td>Medium</td>
            <td>12.0 min</td>

            <td class="action-cell">
                <button class="action-btn" onclick="toggleMenu(this)">
                    <span class="material-icons-round">more_vert</span>
                </button>

                <div class="dropdown-menu">

                    <button type="button"
                            onclick="openModal(&#39;/compu2-class/user/exercises/edit/69127dae6675127bf50cfe19&#39;)"
                            class="dropdown-item">
                        <span class="material-icons-round">edit</span>
                        Editar
                    </button>
                    <form action="/compu2-class/user/exercises/delete/69127dae6675127bf50cfe19" method="post" style="margin: 0;"><input type="hidden" name="_csrf" value="D_fMvJboYnjfrmnwQWknWG9H4Tug4ARxuDMNn46uwKjEb2aOPs-ui6HZUBzyy1mTJUQTbVh-zAKQ0DZc3Atup7_M8J3yWwTv"/>
                        <button type="submit" class="dropdown-item" onclick="return confirm('¿Estás seguro?')">
                            <span class="material-icons-round">delete</span>
                            Eliminar
                        </button>
                    </form>
                </div>
            </td>
        </tr>
        <tr>
            <td>Push-ups</td>
            <td>Strength</td>
            <td>Principiante</td>
            <td>10.0 min</td>

            <td class="action-cell">
                <button class="action-btn" onclick="toggleMenu(this)">
                    <span class="material-icons-round">more_vert</span>
                </button>

                <div class="dropdown-menu">

                    <button type="button"
                            onclick="openModal(&#39;/compu2-class/user/exercises/edit/69127dae6675127bf50cfe18&#39;)"
                            class="dropdown-item">
                        <span class="material-icons-round">edit</span>
                        Editar
                    </button>
                    <form action="/compu2-class/user/exercises/delete/69127dae6675127bf50cfe18" method="post" style="margin: 0;"><input type="hidden" name="_csrf" value="D_fMvJboYnjfrmnwQWknWG9H4Tug4ARxuDMNn46uwKjEb2aOPs-ui6HZUBzyy1mTJUQTbVh-zAKQ0DZc3Atup7_M8J3yWwTv"/>
                        <button type="submit" class="dropdown-item" onclick="return confirm('¿Estás seguro?')">
                            <span class="material-icons-round">delete</span>
                            Eliminar
                        </button>
                    </form>
                </div>
            </td>
        </tr>
        <tr>
            <td>Lunges</td>
            <td>Strength</td>
            <td>Medium</td>
            <td>10.0 min</td>

            <td class="action-cell">
                <button class="action-btn" onclick="toggleMenu(this)">
                    <span class="material-icons-round">more_vert</span>
                </button>

                <div class="dropdown-menu">

                    <button type="button"
                            onclick="openModal(&#39;/compu2-class/user/exercises/edit/69127dae6675127bf50cfe1c&#39;)"
                            class="dropdown-item">
                        <span class="material-icons-round">edit</span>
                        Editar
                    </button>
                    <form action="/compu2-class/user/exercises/delete/69127dae6675127bf50cfe1c" method="post" style="margin: 0;"><input type="hidden" name="_csrf" value="D_fMvJboYnjfrmnwQWknWG9H4Tug4ARxuDMNn46uwKjEb2aOPs-ui6HZUBzyy1mTJUQTbVh-zAKQ0DZc3Atup7_M8J3yWwTv"/>
                        <button type="submit" class="dropdown-item" onclick="return confirm('¿Estás seguro?')">
                            <span class="material-icons-round">delete</span>
                            Eliminar
                        </button>
                    </form>
                </div>
            </td>
        </tr>

        
        </tbody>
    </table>

    <div id="modal-overlay" class="modal-overlay hidden">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">
                <span class="material-icons-round">close</span>
            </button>
            <div id="modal-body"></div>
        </div>
    </div>
    <script>
        // (Script del menú desplegable sin cambios)
        function toggleMenu(button) {
            button.closest('.action-cell').classList.toggle('show-menu');
        }
        document.addEventListener('click', function(event) {
            document.querySelectorAll('.action-cell.show-menu').forEach(cell => {
                if (!cell.contains(event.target)) {
                    cell.classList.remove('show-menu');
                }
            });
        });

        // ===== CAMBIO 4: Script del Modal añadido =====
        async function openModal(url) {
            const overlay = document.getElementById('modal-overlay');
            const body = document.getElementById('modal-body');

            body.innerHTML = '<p class="text-center text-gray-500">Cargando...</p>';
            overlay.classList.remove('hidden');

            try {
                const response = await fetch(url);
                const html = await response.text();
                body.innerHTML = html;
            } catch (err) {
                body.innerHTML = '<p class="text-center text-red-500">Error al cargar el contenido.</p>';
            }
        }

        function closeModal() {
            document.getElementById('modal-overlay').classList.add('hidden');
            document.getElementById('modal-body').innerHTML = '';
        }

        // Cerrar modal si se hace clic fuera del contenido
        document.addEventListener('click', (e) => {
            if (e.target.id === 'modal-overlay') closeModal();
        });
        // =============================================
    </script>
</div>
</html>